<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Online Transcoder (Web-based FFmpeg)</title>
    <meta name="description" content="Online Transcoder (Web-based FFmpeg): Online audio and video transcoding. Easily convert video and audio formats using your browser. Transcoding speed depends on your computer's performance. Recommended for short videos and audio files. Open source project on GitHub.">
    <link crossorigin="anonymous" rel="stylesheet" href="https://cdn.bootcss.com/element-ui/2.9.2/theme-chalk/index.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body>
<div id="app" style="margin-left: 10%; margin-right: 10%;">
    <h1>Online Transcoder (Web-based FFmpeg)</h1>
    <el-row>
        <p>Language/语言:
            <el-link type="primary" href="index.html">English</el-link>
            <el-link type="primary" href="index_zh.html">中文</el-link>
        </p>
    </el-row>
    <h2>Introduction</h2>
    <el-row>
        <p>Convert video and audio formats easily.</p>
        <p>Use your browser to transcode; the speed depends on your computer's performance. It's recommended for converting short videos or audio
            files only. For large videos, use professional software for transcoding.</p>
        <p>
            <el-link type="warning" href="advanced.html">Click to switch to Expert Mode</el-link>
        </p>
        <p>
            <el-link type="success" href="https://github.com/chn-lee-yumi/ffmpeg_on_browser">This project is open source on GitHub</el-link>
        </p>
        <p>
            Other tools:
            <el-link type="success" href="https://tools.gcc.ac.cn/">https://tools.gcc.ac.cn/</el-link>
        </p>
    </el-row>
    <h2>Transcoding Parameters</h2>
    <el-row>
        Video Bitrate:
        <el-input placeholder="Leave blank for default, e.g., 2m, 1m, 512k" v-model="videoBitrate" style="width: 30%;"></el-input>
        (Note: Leave blank for audio files)
    </el-row>
    <el-row>
        Audio Bitrate:
        <el-input placeholder="Leave blank for default, e.g., 128k, 96k" v-model="audioBitrate" style="width: 30%;"></el-input>
    </el-row>
    <el-row>
        Output Filename:
        <el-input placeholder="" v-model="outputName" style="width: 30%;"></el-input>
        (Note: The format is determined by the file extension. Do not use the same name as the selected file.)
    </el-row>
    <h2>Start Transcoding</h2>
    <el-upload v-loading="loading" :on-change="handleFiles" :file-list="fileList" :auto-upload="false">
        <el-button size="big" type="primary">Select File</el-button>
    </el-upload>
    <h2>System Output</h2>
    <el-card class="box-card">
        <pre id="tty" style="white-space: pre-wrap; word-wrap: break-word;"></pre>
    </el-card>
</div>
</body>
<script crossorigin="anonymous" src="https://cdn.bootcss.com/vue/2.6.10/vue.min.js"></script>
<script crossorigin="anonymous" src="https://cdn.bootcss.com/element-ui/2.9.2/index.js"></script>
<script>
var worker = new Worker('worker.js');

worker.onmessage = function (event) {
	console.log(event)
	if(event.data.type=="tty"){
		var temp=document.getElementById("tty").innerHTML
		document.getElementById("tty").innerHTML=temp+"</br>"+event.data.value
		document.body.scrollTop=document.body.scrollHeight;
	} else if (event.data.type=="file"){
		setLoading(false)
		alert("Transcoding complete! Click OK to download the file.")
		downloadFileByBlob(event.data.value,event.data.name)
	}
}

function downloadFileByBlob(blobUrl, filename) {
    const eleLink = document.createElement('a')
    eleLink.download = filename
    eleLink.style.display = 'none'
    eleLink.href = blobUrl
    document.body.appendChild(eleLink)
    eleLink.click()
    document.body.removeChild(eleLink)
}

new Vue({
  el: '#app',
  data: {
	  loading: false,
	  fileList: [],
	  videoBitrate: "",
	  audioBitrate: "",
	  mode: 0,
	  outputName: "output.mp4"
  },
  mounted:function (){
	  window.setLoading=this.setLoading
  },
  methods: {
    handleFiles: function (file, fileList) {
		this.loading=true
		console.log(file.name)
		console.log(this.videoBitrate,this.audioBitrate,this.outputName)
		worker.postMessage({
			"mode":this.mode,
			"fileList":[file.raw],
			"videoBitrate":this.videoBitrate,
			"audioBitrate":this.audioBitrate,
			"outputName":this.outputName})
    },
	setLoading: function (val){
		this.loading=val
		this.fileList=[]
	}
  }
})
</script>
</html>
